name: Auto Organize Algorithm Files

on:
  push:
    branches:
      - ksm
      - jji
      - ish
      - lkh

jobs:
  organize:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Configure Git
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
      
      - name: Organize files
        run: |
          # ë¸Œëœì¹˜ ì´ë¦„ì— ë”°ë¥¸ ì´ë¦„ ë§¤í•‘
          case "${{ github.ref_name }}" in
            ksm) NAME="ê¹€ì„¸ë¯¼" ;;
            jji) NAME="ì¥ì§€ì¸" ;;
            ish) NAME="ì„ì„±í˜" ;;
            lkh) NAME="ì´ê²½í˜¸" ;;
            *) echo "Unknown branch"; exit 1 ;;
          esac
          
          # ì»¤ë°‹ ë‚ ì§œë¡œë¶€í„° ì›”/ì£¼ì°¨ ê³„ì‚°
          COMMIT_DATE=$(git log -1 --format=%cd --date=format:'%Y-%m-%d')
          MONTH=$(date -d "$COMMIT_DATE" +%m 2>/dev/null || date -j -f "%Y-%m-%d" "$COMMIT_DATE" +%m)
          
          # í•´ë‹¹ ì›”ì˜ ì²« ë²ˆì§¸ ë‚  ê³„ì‚°
          YEAR=$(date -d "$COMMIT_DATE" +%Y 2>/dev/null || date -j -f "%Y-%m-%d" "$COMMIT_DATE" +%Y)
          FIRST_DAY="${YEAR}-${MONTH}-01"
          
          # ì£¼ì°¨ ê³„ì‚° (í•´ë‹¹ ì›”ì˜ ëª‡ ë²ˆì§¸ ì£¼ì¸ì§€)
          if date --version >/dev/null 2>&1; then
            # GNU date (Linux)
            COMMIT_DAY=$(date -d "$COMMIT_DATE" +%d)
          else
            # BSD date (macOS)
            COMMIT_DAY=$(date -j -f "%Y-%m-%d" "$COMMIT_DATE" +%d)
          fi
          
          WEEK=$(( (COMMIT_DAY - 1) / 7 + 1 ))
          
          # íƒ€ê²Ÿ í´ë” ìƒì„±
          TARGET_DIR="${MONTH}/week${WEEK}/${NAME}"
          mkdir -p "$TARGET_DIR"
          
          # workspace í´ë”ì—ì„œ Java íŒŒì¼ ì°¾ì•„ì„œ ì´ë™
          if [ -d "workspace" ]; then
            find workspace -name "*.java" -type f | while read -r file; do
              filename=$(basename "$file")
              # ì´ë¯¸ ê°™ì€ ì´ë¦„ì˜ íŒŒì¼ì´ ìˆëŠ”ì§€ í™•ì¸
              if [ -f "${TARGET_DIR}/${filename}" ]; then
                echo "File ${filename} already exists in ${TARGET_DIR}, skipping..."
              else
                cp "$file" "${TARGET_DIR}/${filename}"
                echo "Copied ${filename} to ${TARGET_DIR}"
              fi
            done
          fi
          
          # ë³€ê²½ì‚¬í•­ì´ ìˆëŠ”ì§€ í™•ì¸
          if [ -n "$(git status --porcelain)" ]; then
            git add "${MONTH}/"
            git commit -m "ğŸ“ Auto organize: ${NAME} - ${MONTH}/week${WEEK}"
            
            # main ë¸Œëœì¹˜ë¡œ ì²´í¬ì•„ì›ƒí•˜ê³  ë³‘í•©
            git fetch origin main
            git checkout main
            git merge --no-ff ${{ github.ref_name }} -m "Merge ${NAME}'s solutions for week${WEEK}"
            git push origin main
            
            echo "âœ… Files organized and pushed to main branch"
          else
            echo "â„¹ï¸ No changes to commit"
          fi
